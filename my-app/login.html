<html>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<head>

</head>
<body>

<div id="mainDiv">
<div id="signInDiv">
Name: <input id="name" type="text" name="name" value=""/><br>
Password: <input id="password" type="text" name="password" value=""/><br>
<input id="submit" type="button" value="Submit"/>
<div id="tryAgain"></div>
</div>
<table id="posts">
</table>
<div id="errorDiv"></div>
</div>
</div>



<script>
//var testObj = {title: "trial post 1", message:"I just want to see how this is formatted as a json object.",author: "Tyler", time:"3-12-16 3:05pm"};
//var testObj2 = {"title":"another post","message":"s'more text to see how this works.","author":"Drake","time":"3-12-16 3:14pm"};
//var myConvertedObject = JSON.stringify([testObj,testObj2]);
//console.log(myConvertedObject);

$(document).ready(function() {
	$("#submit").click(checkLogin);
	
});

checkLogin = function() {
	$.post("checkLogin.php", {name : $("#name").val(), password : $("#password").val()}, 
		function(data,status) { 
			if (data == "success") {
				viewPosts();
			}
			else {
				$("#tryAgain").html('<p style="color:red;">Wrong. Try Again</p>');
			}
		}
	);
};
function viewPosts(){
	//replace my div with html to display posts
	$.post("viewPosts.php",
		function(data,status){
			//posts is an array of objects, each of which has a title, message, author, and time string
			//get info like this: posts[0].message
			//TODO: make some html structure with a table to display the posts
			$("#signInDiv").html("<input id=\"destroy\" type=\"button\" value=\"Logout\"/>");
			$("#destroy").click(function () {
				$.post("logout.php", null, 
					function(data,status) { 
						location.reload();
		}
	);
			});
			$("#posts").append(data);
			$("#button0").click(function () {
				//editPost($("tr").get(0));
				console.log("clicked");
			});
	});
};
</script>
<script>
function makeEditDialogue(postJson){
	var post = JSON.parse(postJson);
	var newMsg = prompt("Edit post: " + post.title + "\n" +
	"Original post by " + post.author + " at " + post.time,
	post.message);
	post.message = newMsg;
	return post;
}
//makeEditDialogue(JSON.stringify(posts[0]));
function editPost(postJson){
	var post = makeEditDialogue(postJson);
	//send a json of the updated post to server with updatePosts.php
	$.post("updatePosts.php",post,function(data,status){
		$("#errorDiv").html(data)
		//console.log(data);
		//viewPosts();
	});
}

</script>
</body>
</html>